--- linux-2.6.9/arch/i386/kernel/entry.S.orig
+++ linux-2.6.9/arch/i386/kernel/entry.S
@@ -223,14 +223,18 @@ int80_ret_end_marker:					\
 	.long 222b,555b;\
 .previous
 
-#define __RESTORE_ALL	\
-	__RESTORE_REGS	\
-	__RESTORE_IRET
-
 #define __RESTORE_ALL_USER \
 	__RESTORE_REGS_USER \
 	__RESTORE_IRET
 
+#ifdef CONFIG_X86_HIGH_ENTRY
+#define __RESTORE_ALL	\
+	__RESTORE_REGS	\
+	__RESTORE_IRET
+#else /* !CONFIG_X86_HIGH_ENTRY */
+#define __RESTORE_ALL	__RESTORE_ALL_USER
+#endif
+
 #define __RESTORE_IRET	\
 	addl $4, %esp;	\
 333:	iret;		\
