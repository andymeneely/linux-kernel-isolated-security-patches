--- linux-2.6.9/fs/compat_ioctl.c	2005-11-16 03:35:21.000000000 -0500
+++ linux-2.6.9-fix/fs/compat_ioctl.c	2005-11-16 04:07:17.000000000 -0500
@@ -787,13 +787,16 @@
 		r = (void *) &r4;
 	}
 
-	if (ret)
-		return -EFAULT;
+	if (ret) {
+		ret = -EFAULT;
+		goto out;
+	}
 
 	set_fs (KERNEL_DS);
 	ret = sys_ioctl (fd, cmd, (unsigned long) r);
 	set_fs (old_fs);
 
+out:
 	if (mysock)
 		sockfd_put(mysock);