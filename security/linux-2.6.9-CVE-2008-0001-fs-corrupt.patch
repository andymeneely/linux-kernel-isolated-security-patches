diff -up linux-2.6.9/fs/namei.c.orig linux-2.6.9/fs/namei.c
--- linux-2.6.9/fs/namei.c.orig	2008-01-14 16:04:16.000000000 +0100
+++ linux-2.6.9/fs/namei.c	2008-01-15 13:33:12.000000000 +0100
@@ -1329,7 +1329,7 @@ int may_open(struct nameidata *nd, int a
 	if (S_ISLNK(inode->i_mode))
 		return -ELOOP;
 	
-	if (S_ISDIR(inode->i_mode) && (flag & FMODE_WRITE))
+	if (S_ISDIR(inode->i_mode) && (acc_mode & MAY_WRITE))
 		return -EISDIR;
 
 	error = permission(inode, acc_mode, nd);
@@ -1348,7 +1348,7 @@ int may_open(struct nameidata *nd, int a
 			return -EACCES;
 
 		flag &= ~O_TRUNC;
-	} else if (IS_RDONLY(inode) && (flag & FMODE_WRITE))
+	} else if (IS_RDONLY(inode) && (acc_mode & MAY_WRITE))
 		return -EROFS;
 	/*
 	 * An append-only file must be opened in append mode for writing.
