--- linux-2.6.9/ipc/shm.c.bak	2006-05-31 17:39:34.000000000 -0400
+++ linux-2.6.9/ipc/shm.c	2006-05-31 17:39:57.000000000 -0400
@@ -155,6 +155,8 @@
 {
 	file_accessed(file);
 	vma->vm_ops = &shm_vm_ops;
+	if (!(vma->vm_flags & VM_WRITE))
+		vma->vm_flags &= ~VM_MAYWRITE;
 	shm_inc(file->f_dentry->d_inode->i_ino);
 	return 0;
 }
