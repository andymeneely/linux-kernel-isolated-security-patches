--- linux-2.6.9/arch/x86_64/mm/ioremap.c.bak	2005-10-07 14:35:18.000000000 -0400
+++ linux-2.6.9/arch/x86_64/mm/ioremap.c	2005-10-07 14:40:39.000000000 -0400
@@ -240,13 +240,9 @@ void iounmap(void __iomem *addr)
 	}
 	*pprev = p->next;
 	unmap_vm_area(p);
-	if ((p->flags >> 20) &&
-		p->phys_addr + p->size - 1 < virt_to_phys(high_memory)) {
+	if (p->flags >> 20) {
 		/* p->size includes the guard page, but cpa doesn't like that */
-		change_page_attr(virt_to_page(__va(p->phys_addr)),
-				 (p->size - PAGE_SIZE) >> PAGE_SHIFT,
-				 PAGE_KERNEL); 				 
-		global_flush_tlb();
+		ioremap_change_attr(p->phys_addr, (p->size - PAGE_SIZE), 0);			 
 	} 
 out_unlock:
 	write_unlock(&vmlist_lock);