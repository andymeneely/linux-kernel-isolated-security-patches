--- linux-2.6.9.orig/drivers/block/scsi_ioctl.c	2005-10-12 18:14:36.000000000 -0500
+++ linux-2.6.9/drivers/block/scsi_ioctl.c	2005-10-12 18:41:44.000000000 -0500
@@ -107,12 +107,13 @@ static int sg_emulated_host(request_queu
 
 #define CMD_READ_SAFE	0x01
 #define CMD_WRITE_SAFE	0x02
+#define CMD_WARNED	0x04
 #define safe_for_read(cmd)	[cmd] = CMD_READ_SAFE
 #define safe_for_write(cmd)	[cmd] = CMD_WRITE_SAFE
 
 static int verify_command(struct file *file, unsigned char *cmd)
 {
-	static const unsigned char cmd_type[256] = {
+	static unsigned char cmd_type[256] = {
 
 		/* Basic read-only commands */
 		safe_for_read(TEST_UNIT_READY),
@@ -122,14 +123,15 @@ static int verify_command(struct file *f
 		safe_for_read(READ_12),
 		safe_for_read(READ_16),
 		safe_for_read(READ_BUFFER),
+		safe_for_read(READ_DEFECT_DATA),
 		safe_for_read(READ_LONG),
 		safe_for_read(INQUIRY),
 		safe_for_read(MODE_SENSE),
 		safe_for_read(MODE_SENSE_10),
+		safe_for_read(LOG_SENSE),
 		safe_for_read(START_STOP),
 		safe_for_read(GPCMD_VERIFY_10),
 		safe_for_read(VERIFY_16),
-		safe_for_read(READ_BUFFER),
 
 		/* Audio CD commands */
 		safe_for_read(GPCMD_PLAY_CD),
@@ -166,9 +168,11 @@ static int verify_command(struct file *f
 		safe_for_write(WRITE_VERIFY_12),
 		safe_for_write(WRITE_16),
 		safe_for_write(WRITE_LONG),
+		safe_for_write(WRITE_LONG_2),
 		safe_for_write(ERASE),
 		safe_for_write(GPCMD_MODE_SELECT_10),
 		safe_for_write(MODE_SELECT),
+		safe_for_write(LOG_SELECT),
 		safe_for_write(GPCMD_BLANK),
 		safe_for_write(GPCMD_CLOSE_TRACK),
 		safe_for_write(GPCMD_FLUSH_CACHE),
@@ -201,6 +205,11 @@ static int verify_command(struct file *f
 	if (capable(CAP_SYS_RAWIO))
 		return 0;
 
+	if (!type) {
+		cmd_type[cmd[0]] = CMD_WARNED;
+		printk(KERN_WARNING "scsi: unknown opcode 0x%02x\n", cmd[0]);
+	}
+
 	/* Otherwise fail it with an "Operation not permitted" */
 	return -EPERM;
 }