--- linux-2.6.9/include/linux/skbuff.h.orig	2006-05-22 17:25:40.446058000 -0400
+++ linux-2.6.9/include/linux/skbuff.h	2006-05-22 17:29:19.525759000 -0400
@@ -351,15 +351,11 @@ static inline struct sk_buff *skb_get(st
  */
 static inline void kfree_skb(struct sk_buff *skb)
 {
-	if (atomic_read(&skb->users) == 1 || atomic_dec_and_test(&skb->users))
-		__kfree_skb(skb);
-}
-
-/* Use this if you didn't touch the skb state [for fast switching] */
-static inline void kfree_skb_fast(struct sk_buff *skb)
-{
-	if (atomic_read(&skb->users) == 1 || atomic_dec_and_test(&skb->users))
-		kfree_skbmem(skb);
+	if (likely(atomic_read(&skb->users) == 1))
+		smp_rmb();
+	else if (likely(!atomic_dec_and_test(&skb->users)))
+		return;
+	__kfree_skb(skb);
 }
 
 /**