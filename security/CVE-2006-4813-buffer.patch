--- linux-2.6.9-42.14.EL.orig/fs/buffer.c
+++ linux-2.6.9-42.14.EL/fs/buffer.c
@@ -2031,7 +2031,6 @@ static int __block_prepare_write(struct 
 			if (err)
 				goto out;
 			if (buffer_new(bh)) {
-				clear_buffer_new(bh);
 				unmap_underlying_metadata(bh->b_bdev,
 							bh->b_blocknr);
 				if (PageUptodate(page)) {
@@ -2073,6 +2072,13 @@ static int __block_prepare_write(struct 
 		if (!buffer_uptodate(*wait_bh))
 			return -EIO;
 	}
+
+	bh = head;
+	do {
+		if (buffer_new(bh))
+			clear_buffer_new(bh);
+	} while ((bh = bh->b_this_page) != head);
+
 	return 0;
 out:
 	/*

